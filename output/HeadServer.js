// HeadServer.js
(function(){
Type.registerNamespace('HeadServer');HeadServer.HeadServer=function(){this.fs=require('fs');this.$4=[];this.$5=[];this.$6=[];this.$7=[];this.$2=new CommonShuffleLibraries.QueueManager('Head1',new CommonShuffleLibraries.QueueManagerOptions([new CommonShuffleLibraries.QueueWatcher('HeadServer',null),new CommonShuffleLibraries.QueueWatcher('Head1',null)],['GatewayServer']));this.fs.readFile(this.$0+'/index.html',ss.Delegate.create(this,this.ready));this.$3=new CommonShuffleLibraries.PubSub(ss.Delegate.create(this,function(){
this.$3.subscribe('PUBSUB.GatewayServers',ss.Delegate.create(this,function($p2_0){
this.$4.add(this.$1.replaceAll('{{gateway}}',$p2_0.toString()));this.$5.add($p2_0.toString());}));}));require('http').createServer(ss.Delegate.create(this,this.$A)).listen(8844);this.$2.addChannel('Head.GatewayUpdate',ss.Delegate.create(this,function($p1_0,$p1_1){
this.$4.add(this.$1.replaceAll('{{gateway}}',$p1_1.toString()));this.$5.add($p1_1.toString());}));setInterval(ss.Delegate.create(this,this.$9),5000);this.$9();}
HeadServer.HeadServer.prototype={$0:'/usr/local/src/headServer',$1:null,$2:null,$3:null,$8:0,$9:function(){this.$3.publish('PUBSUB.GatewayServers.Ping','');if(this.$4.length>0){this.$7=this.$4;}if(this.$5.length>0){this.$6=this.$5;}this.$4=[];this.$5=[];this.$8=0;},$A:function($p0,$p1){if(this.$6.length>0){var $0=(this.$8++)%this.$7.length;$p1.end(this.$6[$0]);return;}$p1.end();},$B:function($p0,$p1){var $0={};$0['Content-Type']='text/html';if(this.$7.length>0){$p1.writeHead(200,$0);var $1=(this.$8++)%this.$7.length;$p1.end(this.$7[$1]);}else{$p1.writeHead(200,$0);$p1.end();}},ready:function(error,content){this.$1=content.toString();require('http').createServer(ss.Delegate.create(this,this.$B)).listen(80);}}
HeadServer.HeadServer.registerClass('HeadServer.HeadServer');})();// This script was generated using Script# v0.7.4.0
